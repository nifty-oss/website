<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">One post tagged with &quot;extensions&quot; | nifty-oss</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://nifty-oss.org/img/nifty-oss-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://nifty-oss.org/img/nifty-oss-social-card.jpg"><meta data-rh="true" property="og:url" content="https://nifty-oss.org/blog/tags/extensions"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="One post tagged with &quot;extensions&quot; | nifty-oss"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://nifty-oss.org/blog/tags/extensions"><link data-rh="true" rel="alternate" href="https://nifty-oss.org/blog/tags/extensions" hreflang="en"><link data-rh="true" rel="alternate" href="https://nifty-oss.org/blog/tags/extensions" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="nifty-oss RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="nifty-oss Atom Feed"><link rel="stylesheet" href="/assets/css/styles.062288c3.css">
<script src="/assets/js/runtime~main.30917d29.js" defer="defer"></script>
<script src="/assets/js/main.34676572.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_Z2Yq" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/nifty-logo-small.png" alt="nifty-oss" class="themedComponent_jhL8 themedComponent--light_eGQp"><img src="/img/nifty-logo-small.png" alt="nifty-oss" class="themedComponent_jhL8 themedComponent--dark_WiuS"></div><b class="navbar__title text--truncate">nifty-oss</b></a><a class="navbar__item navbar__link" href="/standard">Nifty Asset</a><a class="navbar__item navbar__link" href="/docs/category/nifty-asset">Documentation</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/nifty-oss/asset" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_RZxO"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle__d4q colorModeToggle_cdjb"><button class="clean-btn toggleButton_gjdH toggleButtonDisabled_CH3w" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_Ne1b"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_hrXT"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer__wvR"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_InnT"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_rsVK thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_OyLv margin-bottom--md">Recent posts</div><ul class="sidebarItemList_GgSF clean-list"><li class="sidebarItem_ZmQi"><a class="sidebarItemLink_mly3" href="/blog/proxy-pattern">Extending program behaviour using a Proxy Pattern</a></li></ul></nav></aside><main class="col col--7"><header class="margin-bottom--xl"><h1>One post tagged with &quot;extensions&quot;</h1><a href="/blog/tags">View All Tags</a></header><article class="margin-bottom--xl"><header><h2 class="title_rsWp"><a href="/blog/proxy-pattern">Extending program behaviour using a Proxy Pattern</a></h2><div class="container_fJZi margin-vert--md"><time datetime="2024-04-04T00:00:00.000Z">April 4, 2024</time> · <!-- -->6 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_oOiV"><div class="avatar margin-bottom--sm"><a href="https://github.com/febo" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/febo.png" alt="febo"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://github.com/febo" target="_blank" rel="noopener noreferrer"><span>febo</span></a></div></div></div></div></div></header><div class="markdown"><p><em>...and defining a program interface in the process.</em></p>
<div class="theme-admonition theme-admonition-tip admonition_aJuu alert alert--success"><div class="admonitionHeading_vBIJ"><span class="admonitionIcon_RVLs"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>TL;DR</div><div class="admonitionContent_USyV"><ul>
<li>Nifty Asset program provides a program interface for developers to fully customise its behaviour.</li>
<li>Follows a simpler and yet more powerful pattern than &quot;hooks&quot;.</li>
<li>No changes are required on the program to support new behaviour.</li>
<li>Client SDK makes using it nearly as trivial as using Nifty Asset directly.</li>
</ul></div></div>
<h3 class="anchor anchorWithStickyNavbar_s992" id="introduction">Introduction<a class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction" href="/blog/tags/extensions#introduction">​</a></h3>
<p>The standard method for extending the behaviour of a program to execute custom logic on Solana involves using &quot;hooks,&quot; which are program-defined callbacks. These callbacks allow a program to incorporate custom logic from a predetermined &quot;hooked&quot; program via Cross-Program Invocation (CPI). This method was first introduced by the Token Extensions program (also known as SPL Token-2022) and its Transfer Hook extension – its purpose is to be able to execute custom logic every time a token from a particular mint is transferred,  including logic that could &quot;block&quot; the transfer of the token.</p>
<p align="center"></p><figure><img src="/assets/images/hook-pattern-f091740d20ed25da8a35c9c5ea4dfc12.jpg" alt="Hook Pattern" width="500"><figcaption><b>The Hook pattern:</b> Program B is a <i>hook</i> on Program A. Program A includes custom logic to invoke Program B.</figcaption></figure><p></p>
<p>The Transfer Hook extension defines a common interface that programs must implement to receive transfer CPI callbacks when a token from a specific mint account is transferred. This callback is guaranteed to occur every time a mint with a transfer hook is transferred. Although this method enables various use cases, including deciding whether a transfer should succeed or not, it has an two important limitations: (1) the target program must embed the logic for hooks, and (2) the hooked program cannot write additional data to an account owned by the target program or perform any other instruction involving the target program. The second limitation arrises from the rule that prohibits program reentry – e.g., if Program A invokes Program B, Program B cannot invoke Program A. While it is possible that a program (Program B) returns data from a CPI call, deciding what to do with the data requires custom logic on the target program (Program A) and the types of actions to be performed will always be limited by the existing logic – new &quot;actions&quot; can only happen if the logic for them is added on Program A.</p>
<h3 class="anchor anchorWithStickyNavbar_s992" id="enter-a-new-pattern-proxy">Enter a new pattern: Proxy<a class="hash-link" aria-label="Direct link to Enter a new pattern: Proxy" title="Direct link to Enter a new pattern: Proxy" href="/blog/tags/extensions#enter-a-new-pattern-proxy">​</a></h3>
<p>For those who are already familiar with design patterns for object-oriented programming, a &quot;<i>Proxy provides a surrogate or placeholder for another object to control access to it</i>&quot;. Replace &quot;another object&quot; by &quot;another program&quot;, and now we have a pattern to gate access to a program. Going back to the initial example of the mint account, our aim is to have a Program B that defines custom behaviour any time Program A is called to transfer a token from a specific mint. In this case, Program B acts as a proxy to Program A. In other words, we flip the &quot;hook&quot; model upside-down and invert its order: Program B (the one that adds custom logic) receives the instruction, performs any custom logic and forwards the instruction to Program A (the one that actually performs the transfer).</p>
<p align="center"></p><figure><img src="/assets/images/proxy-pattern-4162c32d85c196075610009305e98933.jpg" alt="Proxy Pattern" width="500"><figcaption><b>The Proxy pattern:</b> Program B is a proxy to Program A, performing any custom logic without knowledge from Program A.</figcaption></figure><p></p>
<p>This pattern offers two significant benefits. First, it removes the limitations on CPIs from Program B to Program A, allowing Program B to make CPI calls that write additional data to accounts controlled by Program A. Second, Program A is not required to incorporate any custom logic for &quot;hooks&quot; and it does not even need to be aware of any additional logic that was performed.</p>
<p>You might be wondering how to ensure that the proxy program (Program B) is always invoked when an account from Program A is being manipulated. The answer is Program Derived Addresses (PDAs) combined with a simple rule: when Program A is manipulating a &quot;proxied&quot; account – an account that was created as a PDA from Program B – it always requires the account to be a signer. Since a PDA can only be signed by the program from which it was derived, this guarantees that the instruction must be going through the proxy program – the proxy program (Program B) adds the PDA signature for the account before forwarding the instruction to Program A.</p>
<p>For the Proxy pattern to work, the proxy program (Program B) supports the same instructions layout as the target program (Program A) and can add any custom logic when processing these instructions.</p>
<p>We now have a generic pattern to create extensible programs and, in the process, we defined a way to specify program interfaces – it is possible to compose programs together sharing the same interface to add additional behaviour.</p>
<h3 class="anchor anchorWithStickyNavbar_s992" id="putting-it-all-together">Putting it all together<a class="hash-link" aria-label="Direct link to Putting it all together" title="Direct link to Putting it all together" href="/blog/tags/extensions#putting-it-all-together">​</a></h3>
<p>Nifty Asset is the first program implementing the Proxy pattern to allow developers extend its behaviour. This is achieved by:</p>
<ol>
<li>Using a &quot;Proxy&quot; extension to identify accounts that are &quot;proxied&quot; – these accounts will be required to be a signer on instructions that manipulate them. The extension stores the information for clients to determine the address (<code>pubkey</code>) of the proxy program; it also includes the <code>seeds</code> and <code>bump</code> information for a proxy program to add a signature for the account.</li>
</ol>
<p align="center"></p><figure><img src="/assets/images/proxy-extension-1ffba0bbd77b5a796b9bb3e066be0ce9.png" alt="Proxy Extension" width="300"></figure><p></p>
<ol start="2">
<li>Providing a program interface so proxy programs can parse Nifty Asset instructions. Proxy programs implement handlers for each of these instructions to add custom behaviour; the program can also decide that some instructions are not allowed and therefore cannot be executed. The main purpose of the proxy program is to sign the instruction on behalf of the asset account – the address of the asset account is a PDA of the proxy program, so it is the only program that can sign the instruction. Without its signature, the Nifty Asset program will not execute an instruction manipulating a &quot;proxied&quot; asset.</li>
</ol>
<p align="center"></p><figure><img src="/assets/images/processor-89648cfdd9b5b9d14a2f58c6e1ffe8d4.png" alt="Processor" width="500"></figure><p></p>
<ol start="3">
<li>Extending the JavaScript SDK to support executing instructions using a proxy. This is as simple as executing instructions directly on Nifty Asset program. Every instruction builder has an optional &quot;proxy&quot; argument, which corresponds to the address of the proxy program to use when one is needed.</li>
</ol>
<p align="center"></p><figure><img src="/assets/images/sdk-proxy-2a5848ae81f49ef81fd584e112524d9d.png" alt="SDK" width="450"></figure><p></p>
<p>The GitHub <a href="https://github.com/nifty-oss/asset" target="_blank" rel="noopener noreferrer">⎘repository</a> includes an example of a proxy program that tracks the number of times an asset has been transferred and changes the colour of its on-chain image on every transfer.</p>
<h3 class="anchor anchorWithStickyNavbar_s992" id="summary">Summary<a class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary" href="/blog/tags/extensions#summary">​</a></h3>
<p>The Proxy pattern provides a simple, non-intrusive, yet powerful way to extend the behaviour of a program. It allows adding custom behaviour without requiring modifications to the program and avoids limitations of CPI reentrancy and use of return data.</p>
<p>Nifty Asset now provides a program interface for developers to build on top and fully customise its behaviour.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_J5Xz padding--none margin-left--sm"><li class="tag_NSPI"><a class="tag_iTEv tagRegular_eeQ6" href="/blog/tags/solana">solana</a></li><li class="tag_NSPI"><a class="tag_iTEv tagRegular_eeQ6" href="/blog/tags/program">program</a></li><li class="tag_NSPI"><a class="tag_iTEv tagRegular_eeQ6" href="/blog/tags/interface">interface</a></li><li class="tag_NSPI"><a class="tag_iTEv tagRegular_eeQ6" href="/blog/tags/extensions">extensions</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/asset/overview">Overview</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/category/getting-started">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/nifty_oss" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_RZxO"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/ZJebrdQr7K" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_RZxO"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/nifty-oss/asset" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_RZxO"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 nifty-oss</div></div></div></footer></div>
</body>
</html>